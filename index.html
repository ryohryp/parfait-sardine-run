<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>パフェとイワシ RUN! – Character Gacha EX</title>
<link rel="stylesheet" href="styles.css">

<!-- === Presentation Enhancements (Splash / Meta) === -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ff7ad9">

<!-- iOS PWA最適化 -->
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="パフェRUN">
<!-- === /Presentation Enhancements === -->


</head>

<body>
  <div class="scene-wrap" id="sceneWrap">
    <div class="scene-root">
  <!-- === Splash / Fade / Titles / Speedlines === -->
  <div id="splash" class="splash" role="status" aria-live="polite">
    <div class="splash-inner">
      <img src="./icons/icon-192.png" alt="logo" class="splash-logo" />
      <div class="splash-title">Parfait &amp; Sardine RUN!</div>
      <div class="splash-bar"><span class="splash-fill" style="width:0%"></span></div>
      <div class="splash-percent">0%</div>
    </div>
  </div>

  <div id="fade" class="fade" aria-hidden="true"></div>
  <div id="stageTitle" class="stage-title" aria-hidden="true"></div>
  <div id="speedlines" class="speedlines" aria-hidden="true"></div>
  <!-- === /Splash / Fade / Titles / Speedlines === -->

  <header>
    <h1>パフェとイワシ RUN! – Character Gacha EX</h1>
  </header>

  <section id="objective">
    <h2>ゲームの目的</h2>
    <p>令和スタイルのラン＆シュートで、<strong>60秒以内にベストスコアを叩き出し</strong>つつコインを稼ぎ、コレクションを増やしましょう。</p>
    <ul>
      <li><strong>アイテムを集めて</strong>スコアとコインを獲得。集めたコインでガチャを回し、新しいキャラを開放！</li>
      <li><strong>ジャンプと攻撃で敵をかわしつつ撃破</strong>。連続ヒットでスコアがぐんぐん伸びます。</li>
      <li><strong>必殺技ゲージが100%になったら一気に反撃</strong>。キャラ固有のスキルを活かしてハイスコアを狙いましょう。</li>
    </ul>
  </section>

  <div id="wrap">
    <div id="hud" class="hudOverlay">
      <div class="hudRow hudRowPrimary">
        <div class="hudItem hudLife">
          <span class="hudLabel">ライフ</span>
          <span class="hudValue hudHearts">-</span>
          <span class="hudGauge">必殺 0%</span>
        </div>
        <div class="hudItem hudTime">
          <span class="hudLabel">残り時間</span>
          <span class="hudValue">-</span>
        </div>
        <div class="hudItem hudScore">
          <span class="hudLabel">スコア</span>
          <span class="hudValue hudScoreValue">-</span>
        </div>
      </div>
      <div class="hudRow hudRowSecondary">
        <div class="hudItem hudStage">
          <span class="hudLabel">ステージ</span>
          <span class="hudValue">-</span>
          <span class="hudSub">Lv.-</span>
        </div>
        <div class="hudItem hudCoins">
          <span class="hudLabel">コイン</span>
          <span class="hudValue">-</span>
        </div>
        <div class="hudItem hudBest">
          <span class="hudLabel">ベスト</span>
          <span class="hudValue">-</span>
        </div>
      </div>
      <div class="hudEffects isHidden"></div>
    </div>
    <div class="playArea">
      <div id="charInfo" class="muted">CHAR: -</div>
      <canvas id="cv" width="900" height="430"></canvas>
      <div id="startScreen" class="startScreen" aria-hidden="false">
        <div class="startScreenInner">
          <p class="startScreenTitle">走る準備はいい？</p>
          <div class="primaryBtns">
            <button id="start">スタート</button>
            <button id="restart" class="secondary" style="display:none">リスタート</button>
            <button id="howto" class="ghost">遊び方</button>
          </div>
        </div>
      </div>
    </div>
    <div id="touchControls" class="actionBar" aria-hidden="true">
      <button id="jumpBtn" class="touchBtn touchJump" aria-label="ジャンプ">ジャンプ</button>
      <button id="attackBtn" class="touchBtn touchAttack" aria-label="攻撃">攻撃</button>
      <button id="ultBtn" class="touchBtn touchUlt" aria-label="必殺技">必殺技</button>
    </div>

    <div id="btns">
      <div class="secondaryBtns" aria-label="サブメニュー">
        <button id="gachaOpen" class="warn" disabled>ガチャ(10)</button>
        <button id="gacha10" class="warn" disabled>10連(100)</button>
        <button id="collection" class="ghost">コレクション</button>
        <button id="codexBtn" class="ghost">図鑑</button>
        <button id="settingsBtn" class="ghost">設定</button>
        <button id="leaderboardBtn" class="ghost">ランキング</button>
        <button id="commentBtn" class="ghost">コメント</button>
        <span id="versionLabel" class="muted" aria-live="polite"></span>
      </div>
    </div>
    <p class="muted controls"><strong>操作ヒント：</strong>画面左側タップ/クリック＝ジャンプ、右側＝攻撃、右長押し or 右下の<strong>必殺</strong>ボタン＝必殺技（ゲージ100%時）。</p>
  </div>

  <div class="vignette" id="vignette"></div>
  <div class="combo" id="combo"></div>
  <div class="fever" id="fever"></div>
  <div class="boss-band" id="bossBand" style="display:none"></div>
  <div class="boss-intro" id="bossIntro">BOSS APPROACHING...</div>
  <div class="result-wrap" id="result">
    <div class="parfait" aria-label="完成パフェ">
      <div class="layer" id="pfLayer"></div>
      <div class="cream" id="pfCream"></div>
      <div class="fish" id="pfFish"></div>
    </div>
    <div class="result-score" id="resultScore">SCORE: 0</div>
  </div>


    </div>
  </div><!-- /scene-wrap -->

  <button id="updateBtn" class="update-btn" aria-label="バージョン更新">バージョン更新</button>
  <div id="appVersion" class="app-version" aria-live="polite" title="アプリのバージョン">v—</div>

  <!-- === Overlays OUTSIDE scene-wrap (fixed to viewport) === -->
  <div id="uiOverlays">
    <!-- プレゲーム：キャラ選択 -->
    <div id="preGameOverlay" class="overlay" hidden>
      <div class="cardWrap preGameCard">
        <div class="cardHeader">
          <h2>出撃準備</h2>
          <button id="preGameClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody preGameBody">
          <div class="preGameList" id="preGameCharList"></div>
          <div class="preGameInfo">
            <div class="preGameSummary" id="preGameSummary"></div>
            <p class="preGameUlt" id="preGameUlt"></p>
            <div class="preGameSpecial" id="preGameSpecial"></div>
            <ul class="preGameStats" id="preGameStats"></ul>
          </div>
        </div>
        <div class="footerBtns preGameActions">
          <button id="preGameStart" class="secondary cta">ゲームスタート</button>
        </div>
      </div>
    </div>

    <!-- 遊び方 -->
    <div id="howOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>遊び方ガイド</h2>
          <button id="howClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody">
          <p id="howLead" class="howLead"></p>
          <ul id="howList" class="howList"></ul>
          <section id="howObjective" class="howObjective" aria-live="polite"></section>
        </div>
        <div class="howFooter">
          <span id="howFooterNote" class="howFooterNote"></span>
          <button id="howStart" class="secondary">今すぐプレイ</button>
        </div>
      </div>
    </div>

    <!-- ガチャ -->
    <div id="gachaOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>ガチャ結果</h2>
          <button id="gachaClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody">
          <div id="gachaResults" class="grid"></div>
        </div>
        <div class="footerBtns">
          <button id="pull1" class="warn">もう一度(10)</button>
          <button id="pull10" class="warn">10連(100)</button>
        </div>
      </div>
    </div>

    <!-- コレクション -->
    <div id="colOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>コレクション（タップで選択）</h2>
          <button id="colClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody">
          <div id="colGrid" class="grid"></div>
        </div>
        <div class="footerBtns">
          <button id="colEquip" class="secondary" disabled>このキャラを装備</button>
        </div>
      </div>
    </div>

    <!-- 図鑑 -->
    <div id="codexOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>アイテム図鑑</h2>
          <button id="codexClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody">
          <ul id="codexList" class="codexList"></ul>
        </div>
      </div>
    </div>

    <!-- リザルト -->
    <div id="resultOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>リザルト</h2>
          <button id="resultClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody resultBody">
          <div id="resultSummary" class="resultSummary"></div>
          <div class="resultSection">
            <h3>アイテム別スコア内訳</h3>
            <ul id="resultItemList" class="resultList"></ul>
          </div>
          <div class="resultSection">
            <h3>敵撃破スコア内訳</h3>
            <ul id="resultEnemyList" class="resultList"></ul>
          </div>
        </div>
        <div class="footerBtns resultPrimary">
          <button id="resultRetry" class="secondary cta">もう一度挑戦</button>
          <button id="resultMenu" class="ghost cta">メニューに戻る</button>
        </div>
        <div class="footerBtns resultLinks">
          <button id="resultLeaderboard" class="ghost">ランキングを見る</button>
          <button id="resultComment" class="ghost">コメントする</button>
        </div>
      </div>
    </div>

    <!-- ランキング -->
    <div id="leaderboardOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>ランキング</h2>
          <button id="leaderboardClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody">
          <div class="leaderboardControls">
            <span id="leaderboardPlayerName" class="leaderboardPlayerName">現在の名前：-</span>
            <div class="leaderboardControlButtons">
              <button id="leaderboardRename" class="ghost">名前変更</button>
              <button id="leaderboardJump" class="ghost">自分の順位へ</button>
            </div>
          </div>
          <p id="leaderboardStatus" class="howLead">読み込み中…</p>
          <ol id="leaderboardList" class="leaderboardList"></ol>
        </div>
        <div class="footerBtns">
          <button id="leaderboardRefresh" class="secondary">更新</button>
        </div>
      </div>
    </div>

    <!-- コメント -->
    <div id="commentOverlay" class="overlay" hidden>
      <div class="cardWrap">
        <div class="cardHeader">
          <h2>コメント</h2>
          <button id="commentClose" class="ghost">閉じる</button>
        </div>
        <div class="cardBody commentBody">
          <form id="commentForm" class="commentForm" novalidate>
            <label class="commentLabel" for="commentName">
              <span>名前 <small>(必須・1〜40文字)</small></span>
              <input id="commentName" name="name" type="text" maxlength="40" placeholder="お名前" autocomplete="name" required />
            </label>
            <label class="commentLabel" for="commentEmail">
              <span>メールアドレス <small>(任意・公開されません)</small></span>
              <input id="commentEmail" name="email" type="email" inputmode="email" placeholder="example@example.com" autocomplete="email" />
            </label>
            <label class="commentLabel" for="commentMessage">
              <span>コメント <small>(必須・1〜1000文字)</small></span>
              <textarea id="commentMessage" name="message" rows="4" maxlength="1000" placeholder="ゲームの感想をどうぞ！" required></textarea>
            </label>
            <div class="commentFormActions">
              <button id="commentSubmit" class="secondary" type="submit">送信</button>
            </div>
          </form>
  <script type="module" src="js/version.js"></script>
  <script type="module" src="js/scene-scale.js"></script>
  <script type="module" src="main.js"></script>
  rootStyle.setProperty('--scene-base-h', BASE_H + 'px');

  function getVisualHeight(){
    if (window.visualViewport && typeof window.visualViewport.height === 'number') {
      return Math.max(1, window.visualViewport.height);
    }
    return Math.max(1, window.innerHeight);
  }

  function fitScene(){
    const vw = Math.max(1, window.innerWidth);
    const vh = getVisualHeight();
    const scale = Math.min(1, vw / BASE_W, vh / BASE_H);
    rootStyle.setProperty('--scene-scale', scale.toFixed(4));
  }

  window.addEventListener('resize', fitScene, {passive:true});
  window.addEventListener('orientationchange', fitScene, {passive:true});
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', fitScene, {passive:true});
    window.visualViewport.addEventListener('scroll', fitScene, {passive:true});
  }
  document.addEventListener('DOMContentLoaded', fitScene);
  fitScene();
})();
  </script>

</body>
</html>
